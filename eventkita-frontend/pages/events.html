<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Event Detail</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body onload="initEvent()">
  <nav class="topnav">
    <div><a href="user-dashboard.html">‚Üê Back</a></div>
    <div><button onclick="logout()">Logout</button></div>
  </nav>

  <div class="container">
    <h2 id="evTitle"></h2>
    <p id="evDesc"></p>
    <p><strong>Lokasi:</strong> <span id="evLoc"></span></p>
    <p><strong>Tanggal:</strong> <span id="evDate"></span></p>
    <p><strong>Harga:</strong> Rp <span id="evPrice"></span></p>
    <p><strong>Sisa Tiket:</strong> <span id="evQuota"></span></p>

    <label>Jumlah tiket</label>
    <input id="qty" type="number" value="1" min="1">

    <button onclick="createBooking()">Book & Pay</button>
  </div>

  <script src="js/api.js"></script>
  <script src="js/guard.js"></script>
  <script>
    let eventId;
    async function initEvent() {
      if (!requireLogin()) return;
      const params = new URLSearchParams(window.location.search);
      eventId = params.get('id');
      const e = await apiGet(`/events/${eventId}`);
      document.getElementById('evTitle').innerText = e.title || e.name;
      document.getElementById('evDesc').innerText = e.description || e.desc || '';
      document.getElementById('evLoc').innerText = e.location || '';
      document.getElementById('evDate').innerText = e.startDate || e.eventDate || '';
      const price = (e.tickets && e.tickets[0] && e.tickets[0].price) || e.price || 0;
      const quota = (e.tickets && e.tickets[0] && e.tickets[0].quota) || e.quota || 0;
      document.getElementById('evPrice').innerText = price;
      document.getElementById('evQuota').innerText = quota;
    }

    async function createBooking(){
      const quantity = Number(document.getElementById('qty').value);
      const res = await apiPost('/booking/create', { eventId, quantity }, true);
      if (res.error) return alert(res.error);
      // jump to payment page
      window.location.href = `payment.html?bookingId=${res.id}`;
    }
  </script>
</body>
</html>
